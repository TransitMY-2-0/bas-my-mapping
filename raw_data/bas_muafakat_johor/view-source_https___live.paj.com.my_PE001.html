
<!-- saved from url=(0029)https://live.paj.com.my/PE001 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="color-scheme" content="light dark"></head><body><div class="line-gutter-backdrop"></div><form autocomplete="off"><label class="line-wrap-control">Line wrap<input type="checkbox" aria-label="Line wrap"></label></form><table><tbody><tr><td class="line-number" value="1"></td><td class="line-content"><span class="html-doctype">&lt;!DOCTYPE html&gt;</span></td></tr><tr><td class="line-number" value="2"></td><td class="line-content"><span class="html-tag">&lt;html <span class="html-attribute-name">lang</span>="<span class="html-attribute-value">en</span>"&gt;</span></td></tr><tr><td class="line-number" value="3"></td><td class="line-content"><span class="html-tag">&lt;head&gt;</span></td></tr><tr><td class="line-number" value="4"></td><td class="line-content">    <span class="html-tag">&lt;title&gt;</span>Jejak Kedudukan Bas Muafakat Johor<span class="html-tag">&lt;/title&gt;</span></td></tr><tr><td class="line-number" value="5"></td><td class="line-content">    <span class="html-tag">&lt;meta <span class="html-attribute-name">charset</span>="<span class="html-attribute-value">UTF-8</span>"&gt;</span></td></tr><tr><td class="line-number" value="6"></td><td class="line-content">    <span class="html-tag">&lt;meta <span class="html-attribute-name">name</span>="<span class="html-attribute-value">viewport</span>" <span class="html-attribute-name">content</span>="<span class="html-attribute-value">width=device-width, initial-scale=1.0</span>"&gt;</span></td></tr><tr><td class="line-number" value="7"></td><td class="line-content">    <span class="html-tag">&lt;meta <span class="html-attribute-name">name</span>="<span class="html-attribute-value">description</span>" <span class="html-attribute-name">content</span>="<span class="html-attribute-value">Jejak Kedudukan Bas Muafakat Johor</span>"/&gt;</span></td></tr><tr><td class="line-number" value="8"></td><td class="line-content">    <span class="html-tag">&lt;link <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">shortcut icon</span>" <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://live.paj.com.my/assets/logo-paj.png" rel="noreferrer noopener">/assets/logo-paj.png</a>"/&gt;</span></td></tr><tr><td class="line-number" value="9"></td><td class="line-content">    <span class="html-tag">&lt;link <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://api.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.css" rel="noreferrer noopener">https://api.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.css</a>" <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>"&gt;</span></td></tr><tr><td class="line-number" value="10"></td><td class="line-content">    <span class="html-tag">&lt;link <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://live.paj.com.my/assets/plugins/global/plugins.bundle.css" rel="noreferrer noopener">/assets/plugins/global/plugins.bundle.css</a>" <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">text/css</span>"/&gt;</span></td></tr><tr><td class="line-number" value="11"></td><td class="line-content">    <span class="html-tag">&lt;link <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://live.paj.com.my/assets/css/style.bundle.css" rel="noreferrer noopener">/assets/css/style.bundle.css</a>" <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">text/css</span>"/&gt;</span></td></tr><tr><td class="line-number" value="12"></td><td class="line-content">    <span class="html-tag">&lt;link <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css" rel="noreferrer noopener">https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css</a>" <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>"&gt;</span></td></tr><tr><td class="line-number" value="13"></td><td class="line-content">    <span class="html-tag">&lt;style&gt;</span></td></tr><tr><td class="line-number" value="14"></td><td class="line-content">        body {</td></tr><tr><td class="line-number" value="15"></td><td class="line-content">            margin: 0;</td></tr><tr><td class="line-number" value="16"></td><td class="line-content">            padding: 0;</td></tr><tr><td class="line-number" value="17"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="18"></td><td class="line-content">        #map {</td></tr><tr><td class="line-number" value="19"></td><td class="line-content">            position: absolute;</td></tr><tr><td class="line-number" value="20"></td><td class="line-content">            top: 0;</td></tr><tr><td class="line-number" value="21"></td><td class="line-content">            bottom: 0;</td></tr><tr><td class="line-number" value="22"></td><td class="line-content">            width: 100%;</td></tr><tr><td class="line-number" value="23"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="24"></td><td class="line-content">        .legend-card {</td></tr><tr><td class="line-number" value="25"></td><td class="line-content">            position: absolute;</td></tr><tr><td class="line-number" value="26"></td><td class="line-content">            top: 10px;</td></tr><tr><td class="line-number" value="27"></td><td class="line-content">            right: 10px;</td></tr><tr><td class="line-number" value="28"></td><td class="line-content">            background: white;</td></tr><tr><td class="line-number" value="29"></td><td class="line-content">            padding: 15px;</td></tr><tr><td class="line-number" value="30"></td><td class="line-content">            padding-top: 3px;</td></tr><tr><td class="line-number" value="31"></td><td class="line-content">            border-radius: 8px;</td></tr><tr><td class="line-number" value="32"></td><td class="line-content">            box-shadow: 0 2px 4px rgba(0,0,0,0.1);</td></tr><tr><td class="line-number" value="33"></td><td class="line-content">            z-index: 1;</td></tr><tr><td class="line-number" value="34"></td><td class="line-content">            max-width: 200px;</td></tr><tr><td class="line-number" value="35"></td><td class="line-content">            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;</td></tr><tr><td class="line-number" value="36"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="37"></td><td class="line-content">        .legend-title {</td></tr><tr><td class="line-number" value="38"></td><td class="line-content">            font-weight: 600;</td></tr><tr><td class="line-number" value="39"></td><td class="line-content">            font-size: 14px;</td></tr><tr><td class="line-number" value="40"></td><td class="line-content">            margin: 0 0 10px 0;</td></tr><tr><td class="line-number" value="41"></td><td class="line-content">            color: #333;</td></tr><tr><td class="line-number" value="42"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="43"></td><td class="line-content">        .legend-item {</td></tr><tr><td class="line-number" value="44"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="45"></td><td class="line-content">            align-items: center;</td></tr><tr><td class="line-number" value="46"></td><td class="line-content">            margin-bottom: 8px;</td></tr><tr><td class="line-number" value="47"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="48"></td><td class="line-content">        .legend-item:last-child {</td></tr><tr><td class="line-number" value="49"></td><td class="line-content">            margin-bottom: 0;</td></tr><tr><td class="line-number" value="50"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="51"></td><td class="line-content">        .legend-icon {</td></tr><tr><td class="line-number" value="52"></td><td class="line-content">            width: 20px;</td></tr><tr><td class="line-number" value="53"></td><td class="line-content">            height: 20px;</td></tr><tr><td class="line-number" value="54"></td><td class="line-content">            margin-right: 8px;</td></tr><tr><td class="line-number" value="55"></td><td class="line-content">            background-size: contain;</td></tr><tr><td class="line-number" value="56"></td><td class="line-content">            background-repeat: no-repeat;</td></tr><tr><td class="line-number" value="57"></td><td class="line-content">            background-position: center;</td></tr><tr><td class="line-number" value="58"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="59"></td><td class="line-content">        .legend-text {</td></tr><tr><td class="line-number" value="60"></td><td class="line-content">            font-size: 12px;</td></tr><tr><td class="line-number" value="61"></td><td class="line-content">            color: #666;</td></tr><tr><td class="line-number" value="62"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="63"></td><td class="line-content">        .legend-route {</td></tr><tr><td class="line-number" value="64"></td><td class="line-content">            background-color: #ff0000;</td></tr><tr><td class="line-number" value="65"></td><td class="line-content">            width: 20px;</td></tr><tr><td class="line-number" value="66"></td><td class="line-content">            height: 3px;</td></tr><tr><td class="line-number" value="67"></td><td class="line-content">            margin-right: 8px;</td></tr><tr><td class="line-number" value="68"></td><td class="line-content">            border-radius: 2px;</td></tr><tr><td class="line-number" value="69"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="70"></td><td class="line-content">        .mapboxgl-popup-content {</td></tr><tr><td class="line-number" value="71"></td><td class="line-content">            padding: 15px;</td></tr><tr><td class="line-number" value="72"></td><td class="line-content">            border-radius: 8px;</td></tr><tr><td class="line-number" value="73"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="74"></td><td class="line-content">        .bus-stop-name {</td></tr><tr><td class="line-number" value="75"></td><td class="line-content">            font-weight: bold;</td></tr><tr><td class="line-number" value="76"></td><td class="line-content">            margin: 0;</td></tr><tr><td class="line-number" value="77"></td><td class="line-content">            color: #333;</td></tr><tr><td class="line-number" value="78"></td><td class="line-content">            font-size: 14px;</td></tr><tr><td class="line-number" value="79"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="80"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="81"></td><td class="line-content">        /* New styles for the sliding cards */</td></tr><tr><td class="line-number" value="82"></td><td class="line-content">        .bus-cards-container {</td></tr><tr><td class="line-number" value="83"></td><td class="line-content">            position: fixed;</td></tr><tr><td class="line-number" value="84"></td><td class="line-content">            bottom: 30px;</td></tr><tr><td class="line-number" value="85"></td><td class="line-content">            left: 50%;</td></tr><tr><td class="line-number" value="86"></td><td class="line-content">            transform: translateX(-50%);</td></tr><tr><td class="line-number" value="87"></td><td class="line-content">            /*height: 50px;*/</td></tr><tr><td class="line-number" value="88"></td><td class="line-content">            background: transparent;</td></tr><tr><td class="line-number" value="89"></td><td class="line-content">            overflow-x: auto;</td></tr><tr><td class="line-number" value="90"></td><td class="line-content">            white-space: nowrap;</td></tr><tr><td class="line-number" value="91"></td><td class="line-content">            padding-top: 10px;</td></tr><tr><td class="line-number" value="92"></td><td class="line-content">            padding-bottom: 10px;</td></tr><tr><td class="line-number" value="93"></td><td class="line-content">            padding-left: 10px;</td></tr><tr><td class="line-number" value="94"></td><td class="line-content">            /*padding-bottom: 10px;*/</td></tr><tr><td class="line-number" value="95"></td><td class="line-content">            scrollbar-width: none; /* Firefox */</td></tr><tr><td class="line-number" value="96"></td><td class="line-content">            -ms-overflow-style: none; /* IE and Edge */</td></tr><tr><td class="line-number" value="97"></td><td class="line-content">            z-index: 1000;</td></tr><tr><td class="line-number" value="98"></td><td class="line-content">            width: 100%;</td></tr><tr><td class="line-number" value="99"></td><td class="line-content">            max-width: 1200px;</td></tr><tr><td class="line-number" value="100"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="101"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="102"></td><td class="line-content">        /*.bus-cards-container::-webkit-scrollbar {*/</td></tr><tr><td class="line-number" value="103"></td><td class="line-content">        /*    display: none; !* Chrome, Safari, Opera *!*/</td></tr><tr><td class="line-number" value="104"></td><td class="line-content">        /*}*/</td></tr><tr><td class="line-number" value="105"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="106"></td><td class="line-content">        .bus-card {</td></tr><tr><td class="line-number" value="107"></td><td class="line-content">            display: inline-block;</td></tr><tr><td class="line-number" value="108"></td><td class="line-content">            width: 160px;</td></tr><tr><td class="line-number" value="109"></td><td class="line-content">            height: 60px;</td></tr><tr><td class="line-number" value="110"></td><td class="line-content">            margin-right: 10px;</td></tr><tr><td class="line-number" value="111"></td><td class="line-content">            background: rgba(255, 255, 255, 0.9);</td></tr><tr><td class="line-number" value="112"></td><td class="line-content">            border-radius: 8px;</td></tr><tr><td class="line-number" value="113"></td><td class="line-content">            padding: 10px;</td></tr><tr><td class="line-number" value="114"></td><td class="line-content">            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);</td></tr><tr><td class="line-number" value="115"></td><td class="line-content">            vertical-align: top;</td></tr><tr><td class="line-number" value="116"></td><td class="line-content">            cursor: pointer;</td></tr><tr><td class="line-number" value="117"></td><td class="line-content">            transition: all 0.2s ease;</td></tr><tr><td class="line-number" value="118"></td><td class="line-content">            backdrop-filter: blur(5px);</td></tr><tr><td class="line-number" value="119"></td><td class="line-content">            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; /* Add this line */</td></tr><tr><td class="line-number" value="120"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="121"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="122"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="123"></td><td class="line-content">        .bus-card:hover {</td></tr><tr><td class="line-number" value="124"></td><td class="line-content">            transform: translateY(-2px);</td></tr><tr><td class="line-number" value="125"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="126"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="127"></td><td class="line-content">        .bus-card.active {</td></tr><tr><td class="line-number" value="128"></td><td class="line-content">            background: #e3f2fd;</td></tr><tr><td class="line-number" value="129"></td><td class="line-content">            border: 2px solid #2196f3;</td></tr><tr><td class="line-number" value="130"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="131"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="132"></td><td class="line-content">        .bus-id {</td></tr><tr><td class="line-number" value="133"></td><td class="line-content">            /*font-weight: bold;*/</td></tr><tr><td class="line-number" value="134"></td><td class="line-content">            /*font-size: 16px;*/</td></tr><tr><td class="line-number" value="135"></td><td class="line-content">            color: #434343;</td></tr><tr><td class="line-number" value="136"></td><td class="line-content">            margin: 0 0 5px 0;</td></tr><tr><td class="line-number" value="137"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="138"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="139"></td><td class="line-content">        .last-update {</td></tr><tr><td class="line-number" value="140"></td><td class="line-content">            font-size: 12px;</td></tr><tr><td class="line-number" value="141"></td><td class="line-content">            color: #666;</td></tr><tr><td class="line-number" value="142"></td><td class="line-content">            margin: 0;</td></tr><tr><td class="line-number" value="143"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="144"></td><td class="line-content">        .online {</td></tr><tr><td class="line-number" value="145"></td><td class="line-content">            /*background: #0fa354;*/</td></tr><tr><td class="line-number" value="146"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="147"></td><td class="line-content">        .offline {</td></tr><tr><td class="line-number" value="148"></td><td class="line-content">            background: #dadada;</td></tr><tr><td class="line-number" value="149"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="150"></td><td class="line-content">        /*.logo-container img {*/</td></tr><tr><td class="line-number" value="151"></td><td class="line-content">        /*    height: 40px;*/</td></tr><tr><td class="line-number" value="152"></td><td class="line-content">        /*    width: auto;*/</td></tr><tr><td class="line-number" value="153"></td><td class="line-content">        /*}*/</td></tr><tr><td class="line-number" value="154"></td><td class="line-content"> .back-btn{</td></tr><tr><td class="line-number" value="155"></td><td class="line-content">      display:inline-flex;</td></tr><tr><td class="line-number" value="156"></td><td class="line-content">      align-items:center;</td></tr><tr><td class="line-number" value="157"></td><td class="line-content">      gap:8px;</td></tr><tr><td class="line-number" value="158"></td><td class="line-content">      margin-top:10px;</td></tr><tr><td class="line-number" value="159"></td><td class="line-content">      padding:8px 12px;</td></tr><tr><td class="line-number" value="160"></td><td class="line-content">      border-radius:8px;</td></tr><tr><td class="line-number" value="161"></td><td class="line-content">      border:1px solid rgba(0,0,0,.08);</td></tr><tr><td class="line-number" value="162"></td><td class="line-content">      background:#f4f6f8;</td></tr><tr><td class="line-number" value="163"></td><td class="line-content">      font-size:12px;</td></tr><tr><td class="line-number" value="164"></td><td class="line-content">      font-weight:600;</td></tr><tr><td class="line-number" value="165"></td><td class="line-content">      color:#2b2e34;</td></tr><tr><td class="line-number" value="166"></td><td class="line-content">      text-decoration:none;</td></tr><tr><td class="line-number" value="167"></td><td class="line-content">      box-shadow:0 1px 2px rgba(0,0,0,.06);</td></tr><tr><td class="line-number" value="168"></td><td class="line-content">      transition:transform .12s ease, background .12s ease;</td></tr><tr><td class="line-number" value="169"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="170"></td><td class="line-content">  .back-btn:hover{ background:#e9ecef; transform:translateY(-1px); }</td></tr><tr><td class="line-number" value="171"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="172"></td><td class="line-content">  .legend-card{ z-index: 2001!important; } /* pastikan atas Mapbox controls */</td></tr><tr><td class="line-number" value="173"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="174"></td><td class="line-content">  .legend-nav {</td></tr><tr><td class="line-number" value="175"></td><td class="line-content">    display:flex; gap:8px; margin-top:10px; flex-wrap:wrap;</td></tr><tr><td class="line-number" value="176"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="177"></td><td class="line-content">.legend-btn {</td></tr><tr><td class="line-number" value="178"></td><td class="line-content">    display:inline-flex; align-items:center; gap:6px;</td></tr><tr><td class="line-number" value="179"></td><td class="line-content">    background:#f4f6f8; border:1px solid #e2e8f0; border-radius:8px;</td></tr><tr><td class="line-number" value="180"></td><td class="line-content">    padding:8px 10px; font-size:12px; color:#333; text-decoration:none;</td></tr><tr><td class="line-number" value="181"></td><td class="line-content">    box-shadow:0 1px 2px rgba(0,0,0,.05);</td></tr><tr><td class="line-number" value="182"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="183"></td><td class="line-content">.legend-btn:hover { background:#eef2f6; }</td></tr><tr><td class="line-number" value="184"></td><td class="line-content">.legend-btn .kecil { opacity:.7; font-weight:600; }</td></tr><tr><td class="line-number" value="185"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="186"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="187"></td><td class="line-content">    <span class="html-tag">&lt;/style&gt;</span></td></tr><tr><td class="line-number" value="188"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="189"></td><td class="line-content">    <span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://unpkg.com/@turf/turf@6.5.0/turf.min.js" rel="noreferrer noopener">https://unpkg.com/@turf/turf@6.5.0/turf.min.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="190"></td><td class="line-content"><span class="html-tag">&lt;/head&gt;</span></td></tr><tr><td class="line-number" value="191"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="192"></td><td class="line-content"><span class="html-tag">&lt;body&gt;</span></td></tr><tr><td class="line-number" value="193"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">map</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="194"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">bus-cards-container</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">busCards</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="195"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">legend-card text-center</span>"&gt;</span></td></tr><tr><td class="line-number" value="196"></td><td class="line-content">    <span class="html-tag">&lt;img <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://live.paj.com.my/assets/logo-main.png" rel="noreferrer noopener">https://live.paj.com.my/assets/logo-main.png</a>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">logo-container mt-2</span>" <span class="html-attribute-name">alt</span>="<span class="html-attribute-value">Logo</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width: 70px; height: auto;</span>"&gt;</span></td></tr><tr><td class="line-number" value="197"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="198"></td><td class="line-content">    <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">legend-item</span>"&gt;</span></td></tr><tr><td class="line-number" value="199"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">legend-icon</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">background-image: url(https://live.paj.com.my/assets/bus-marker.png)</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="200"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">legend-text</span>"&gt;</span>Bas<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="201"></td><td class="line-content">    <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="202"></td><td class="line-content">    <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">legend-item</span>"&gt;</span></td></tr><tr><td class="line-number" value="203"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">legend-icon</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">background-image: url(https://live.paj.com.my/assets/bus-stop-marker.png)</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="204"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">legend-text</span>"&gt;</span>Perhentian<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="205"></td><td class="line-content">    <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="206"></td><td class="line-content">    <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">legend-item</span>"&gt;</span></td></tr><tr><td class="line-number" value="207"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">legend-route</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="208"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">legend-text</span>"&gt;</span>Laluan<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="209"></td><td class="line-content">    <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="210"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="211"></td><td class="line-content">    <span class="html-comment">&lt;!-- NEW: Butang Kembali --&gt;</span></td></tr><tr><td class="line-number" value="212"></td><td class="line-content">    <span class="html-tag">&lt;a <span class="html-attribute-name">class</span>="<span class="html-attribute-value">back-btn</span>" <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="https://live.paj.com.my/" rel="noreferrer noopener">https://live.paj.com.my</a>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">btnBack</span>"&gt;</span></td></tr><tr><td class="line-number" value="213"></td><td class="line-content">        <span class="html-comment">&lt;!-- ikon anak panah kecil (SVG inline supaya tiada dependensi) --&gt;</span></td></tr><tr><td class="line-number" value="214"></td><td class="line-content">        <span class="html-tag">&lt;svg <span class="html-attribute-name">width</span>="<span class="html-attribute-value">14</span>" <span class="html-attribute-name">height</span>="<span class="html-attribute-value">14</span>" <span class="html-attribute-name">viewBox</span>="<span class="html-attribute-value">0 0 24 24</span>" <span class="html-attribute-name">fill</span>="<span class="html-attribute-value">none</span>" <span class="html-attribute-name">aria-hidden</span>="<span class="html-attribute-value">true</span>"&gt;</span></td></tr><tr><td class="line-number" value="215"></td><td class="line-content">          <span class="html-tag">&lt;path <span class="html-attribute-name">d</span>="<span class="html-attribute-value">M10 19l-7-7 7-7</span>" <span class="html-attribute-name">stroke</span>="<span class="html-attribute-value">#2b2e34</span>" <span class="html-attribute-name">stroke-width</span>="<span class="html-attribute-value">2</span>" <span class="html-attribute-name">stroke-linecap</span>="<span class="html-attribute-value">round</span>" <span class="html-attribute-name">stroke-linejoin</span>="<span class="html-attribute-value">round</span>"/&gt;</span></td></tr><tr><td class="line-number" value="216"></td><td class="line-content">          <span class="html-tag">&lt;path <span class="html-attribute-name">d</span>="<span class="html-attribute-value">M3 12h18</span>" <span class="html-attribute-name">stroke</span>="<span class="html-attribute-value">#2b2e34</span>" <span class="html-attribute-name">stroke-width</span>="<span class="html-attribute-value">2</span>" <span class="html-attribute-name">stroke-linecap</span>="<span class="html-attribute-value">round</span>" <span class="html-attribute-name">stroke-linejoin</span>="<span class="html-attribute-value">round</span>"/&gt;</span></td></tr><tr><td class="line-number" value="217"></td><td class="line-content">        <span class="html-tag">&lt;/svg&gt;</span></td></tr><tr><td class="line-number" value="218"></td><td class="line-content">        Kembali</td></tr><tr><td class="line-number" value="219"></td><td class="line-content">    <span class="html-tag">&lt;/a&gt;</span></td></tr><tr><td class="line-number" value="220"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="221"></td><td class="line-content"><span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://code.jquery.com/jquery-3.6.0.min.js" rel="noreferrer noopener">https://code.jquery.com/jquery-3.6.0.min.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="222"></td><td class="line-content"><span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://api.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.js" rel="noreferrer noopener">https://api.mapbox.com/mapbox-gl-js/v3.8.0/mapbox-gl.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="223"></td><td class="line-content"><span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="224"></td><td class="line-content">    let geojson = {"name":"PE001","type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[104.2283558438127,1.554952978558255],[104.2283542672873,1.555073888365499],[104.2280854158811,1.554882673843526],[104.2275084408269,1.554372765677436],[104.227477299668,1.553677524595193],[104.2303346905324,1.553361729579638],[104.2304862629754,1.553430284000998],[104.2306350498752,1.55334842068408],[104.2313863226794,1.553286988875068],[104.2345740027503,1.553811008448583],[104.2361397589871,1.553951330384781],[104.2372216800546,1.553883084728009],[104.2400882721782,1.55322124056393],[104.2408784236669,1.553166566224589],[104.2455649696248,1.553651366402547],[104.24687503755,1.553868910314287],[104.2476036395943,1.549688416018681],[104.2491730325009,1.544173234271907],[104.2541920290253,1.53571240191291],[104.2547081223388,1.535819046617873],[104.2550754057137,1.535712408222219],[104.2558587506043,1.534825853960022],[104.2560007290906,1.534648179626946],[104.2581775888759,1.534164104717765],[104.2587394779257,1.534178677757662],[104.2603343625611,1.535304017190752],[104.2618825085155,1.536419024618064],[104.2636116688877,1.536649968291335],[104.2643970726031,1.536976023486444],[104.2646616944249,1.537431092489589],[104.2656005038478,1.53854290881477],[104.266692250511,1.537503526554492],[104.2676123857366,1.536827234843766],[104.2688377921554,1.535711482653366],[104.2695400898062,1.535095987768951],[104.2697230517601,1.534910718023917],[104.2699934029901,1.53427619937626],[104.2700980404265,1.533878457067034],[104.2701317794256,1.5335671496835],[104.2700932893743,1.53313553819317],[104.2700786525651,1.532862405815206],[104.2700502324374,1.532474749928101],[104.2701310589865,1.532129988701872],[104.270227070059,1.531743061942571],[104.2703805814894,1.531144623560599],[104.2704305327906,1.530935694097734],[104.2707521349489,1.530614634405078],[104.2711515349175,1.530320592258373],[104.2720100869887,1.529999404213635],[104.272739174022,1.529743308881877],[104.2731036867319,1.529615451446156],[104.2736602135034,1.529259196369841],[104.2745191769575,1.528733769804603],[104.2756665025304,1.528380091914386],[104.2759389520308,1.528310760470737],[104.276624226278,1.528016403361142],[104.2768655634879,1.527748962456466],[104.2772053224775,1.527377252998459],[104.2774769455826,1.526747046043208],[104.2775185221101,1.526442652821367],[104.277527887808,1.525818496789362],[104.2772996452777,1.525079718246873],[104.2771022645672,1.524546320294809],[104.2769729194001,1.523833126754065],[104.2767798067447,1.522469213814605],[104.2766762592463,1.521585344900312],[104.2766770549177,1.520905296106464],[104.2770130308347,1.520621069783787],[104.2774557434618,1.520105696464302],[104.2779186471751,1.519755304507992],[104.2783021891664,1.519422597935596],[104.2789664515635,1.519076474368568],[104.2800374306134,1.518567131563491],[104.2806365896318,1.518432075567534],[104.2810474917541,1.518314115795366],[104.281365319964,1.518121135014299],[104.2816720939884,1.517767891517064],[104.2819126393525,1.517363255105196],[104.2820702939113,1.516922181661713],[104.282241452997,1.516294349328295],[104.2823450625287,1.516195952873311],[104.2824584005727,1.516157709399198],[104.2827421284008,1.516186269627172],[104.2829793685593,1.516297572244262],[104.2832359959619,1.516379381284387],[104.2835960611794,1.516536906432024],[104.283961425292,1.516673604714732],[104.2843786674186,1.515670737158715],[104.2841603473077,1.515593792193638],[104.2838831413311,1.516482743159831],[104.2832121749273,1.516255723647949],[104.282815523768,1.516142528663948],[104.2824237555785,1.516134413628634],[104.2822356381078,1.51617563205673],[104.2821261572699,1.516487669211251],[104.2819213022751,1.517194891079333],[104.2817637719036,1.517578021007655],[104.2814600106519,1.517960798932748],[104.2811394870174,1.518206514444856],[104.2807098797685,1.518375925835961],[104.2803134841339,1.518474065335581],[104.279677009037,1.51866713003571],[104.278798141908,1.519093169135176],[104.2786633484082,1.519185604914294],[104.277953853939,1.519668293947515],[104.2774624105937,1.520021168005112],[104.276961465807,1.520479546283995],[104.2766353137766,1.520808790332622],[104.276594405411,1.521303747757619],[104.2766923471829,1.522071648576347],[104.2767837127713,1.523121358066293],[104.2770129606203,1.524281445664535],[104.2771630130514,1.524922279275483],[104.2773950938225,1.525619939254034],[104.2774703217587,1.526013675822504],[104.2774257636447,1.526635635537978],[104.2772725481783,1.527126612253693],[104.276959372344,1.527577105750906],[104.2764986109908,1.528014453287873],[104.2751944945939,1.528468870655041],[104.2746309689865,1.52865494097435],[104.273898146905,1.529074739181228],[104.2731981584883,1.529510682402914],[104.2725615517547,1.529764582727858],[104.271507520685,1.530145512945931],[104.2709220092141,1.530432575670912],[104.2705201249496,1.530797275174451],[104.2703996610194,1.530914222714295],[104.270181184045,1.531810562262365],[104.2700783683849,1.532282808665975],[104.2700037336785,1.532652000535784],[104.2700682421736,1.533225675000803],[104.2700544146658,1.533883952127022],[104.2697873236029,1.534655363076874],[104.269602762879,1.534965577100196],[104.2683077448027,1.536151908235679],[104.266955286863,1.537280257371536],[104.2657354645368,1.538514880224462],[104.2655087980125,1.538807155468354],[104.2652901153517,1.538788654732427],[104.2651921479903,1.538567481234831],[104.2652248719836,1.538420177433672],[104.2647101788511,1.537656064514069],[104.2642947476003,1.537081274988249],[104.263479925915,1.536718423046183],[104.2633515206228,1.536726643427647],[104.2623907692953,1.536636318886824],[104.2621126374935,1.536587061334799],[104.2618273150668,1.536492962602448],[104.2604292859662,1.535507964317284],[104.2597603863031,1.53518667627198],[104.2592851805726,1.535966675633884],[104.2592418827147,1.536914807796779],[104.2589815617858,1.537410656092062],[104.2584233353565,1.538406209387174],[104.2582869410865,1.539049758683541],[104.2584254994346,1.540221719203875],[104.2585335063294,1.540885056518905],[104.2584881218818,1.541547982465825],[104.2590750886348,1.542770224755527],[104.2599451351781,1.544397585033464],[104.2603081333603,1.5450609927612],[104.2607610226135,1.545517509677619],[104.2609820179012,1.545607643618859],[104.2621368638729,1.543977919464419],[104.262498236804,1.543597493336775],[104.2626817790433,1.543416029277658],[104.2630995310713,1.543038984827767],[104.2634231003373,1.542875028222653],[104.2636018854419,1.542799365483869],[104.2635690098084,1.542639165058044],[104.263450453987,1.542598575771729],[104.263218804978,1.542810085947125],[104.2629252072002,1.543065775998884],[104.2623832662553,1.543620821005166],[104.2617994562244,1.544326701925596],[104.2612973808259,1.54500990126116],[104.2610793711218,1.545653177828607],[104.2609884895055,1.546292704400229],[104.2604267086859,1.5484368329017],[104.2595778282511,1.550513817451435],[104.2565031144117,1.552735610100152],[104.2546483068955,1.556651766414823],[104.253113318425,1.55985811268422],[104.2523017492245,1.560935486567532],[104.2496772295136,1.562794358540753],[104.2466885611363,1.564700489416296],[104.2454381607962,1.564909218426086],[104.2453226828602,1.564968510965598],[104.2452419250669,1.564952305616197],[104.2451717826072,1.564866387251548],[104.2445191049148,1.564765555405668],[104.239424417513,1.564088204797437],[104.2327624705718,1.563290330954613],[104.2315908747873,1.563306379748469],[104.2304411516548,1.563402428056388],[104.2290061495999,1.563903911590917],[104.2271779100489,1.564993613384729],[104.2247222594675,1.567766452640749],[104.2227174133581,1.5698677670964],[104.2198584145169,1.571953415405006],[104.2168348225784,1.572990151257874],[104.2142168762345,1.572971200704412],[104.21140106042,1.572937358813421],[104.206475230495,1.572640459502492],[104.2063156163064,1.5733721620071],[104.2059854699941,1.574293012887654],[104.2055884641552,1.575252145073428],[104.2050411234369,1.575043246349566],[104.2044105023041,1.576474915130573],[104.2040369408469,1.577424474127473],[104.2097268572199,1.579950838117258],[104.210712247372,1.577928172141192],[104.2135164879175,1.578253825270914],[104.2149767255448,1.578411182082892],[104.2185186031693,1.578385493031256],[104.2195526496197,1.578383842446817],[104.2207497045071,1.578326139700995],[104.2205461187904,1.575536682544962],[104.2205945835162,1.575401787582397],[104.2205542932261,1.575346645498068],[104.2205125107803,1.575268272825466],[104.2205219288397,1.574800202555553],[104.2205279274903,1.574785140745874],[104.2205339999642,1.573926871901076],[104.2199090812839,1.572609419655548],[104.2197182022215,1.572068458971664],[104.2210301866487,1.571261052448002],[104.222208866532,1.570420482180427],[104.2231033320413,1.569590291891848],[104.2203903169758,1.565499227832908],[104.2201083762008,1.564932565525123],[104.2199736863447,1.563075101832284],[104.2198637138072,1.561038348719238],[104.219704464164,1.559192983798502],[104.2193915688563,1.557033141847797],[104.2191962002251,1.554731814906143],[104.2223011655186,1.554316547934183],[104.2242962169868,1.554092863406656],[104.2272819046569,1.553703698574229],[104.2273734364048,1.553730070271269],[104.2286671726729,1.553519615180295],[104.2303401463553,1.553303325102556],[104.2304438059747,1.553541851561974],[104.2305652129994,1.554751755642346],[104.2305631547777,1.554811757279792],[104.2290873179093,1.554994287338095],[104.228858082395,1.555108334588847],[104.2287089918372,1.555234815790903],[104.2285710922911,1.555123876778583],[104.2284615873508,1.554998041617161]]}}]};</td></tr><tr><td class="line-number" value="225"></td><td class="line-content">    let pois = [{"name":"Kolej Komuniti Bandar Penawar","lat":"1.56341300","lng":"104.21986100"},{"name":"Kolej Profesional MARA","lat":"1.56501200","lng":"104.22008100"},{"name":"Sek Men. Sains Kota Tinggi (SSKT)","lat":"1.56699100","lng":"104.22536400"},{"name":"SMKA Bandar Penawar","lat":"1.56536600","lng":"104.22686700"},{"name":"SMK Bandar Penawar","lat":"1.56394000","lng":"104.22900900"},{"name":"Pantai Desaru","lat":"1.54622900","lng":"104.26101500"},{"name":"Desaru Coast","lat":"1.53636200","lng":"104.26328800"},{"name":"Kolej Delima INSTEDT","lat":"1.55303400","lng":"104.23989600"},{"name":"Majid As-Syifa Bandar Penawar","lat":"1.55360600","lng":"104.23661500"},{"name":"Klinik Kesihatan Bandar Penawar","lat":"1.55326700","lng":"104.23310400"},{"name":"Terminal Bas And Teksi Bandar Penawar","lat":"1.55490527","lng":"104.22837170"},{"name":"Terminal Bas And Teksi Bandar Penawar","lat":"1.55490527","lng":"104.22837170"}];</td></tr><tr><td class="line-number" value="226"></td><td class="line-content">    let imageBusStop = 'https://live.paj.com.my/assets/bus-stop-marker.png';</td></tr><tr><td class="line-number" value="227"></td><td class="line-content">    let imageArrows = 'https://live.paj.com.my/assets/arrow-markers-red.png';</td></tr><tr><td class="line-number" value="228"></td><td class="line-content">    let imageBus = 'https://live.paj.com.my/assets/bus-marker.png';</td></tr><tr><td class="line-number" value="229"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="230"></td><td class="line-content">    // Convert POIs to GeoJSON format</td></tr><tr><td class="line-number" value="231"></td><td class="line-content">    const poisGeoJSON = {</td></tr><tr><td class="line-number" value="232"></td><td class="line-content">        type: 'FeatureCollection',</td></tr><tr><td class="line-number" value="233"></td><td class="line-content">        features: pois.map(poi =&gt; ({</td></tr><tr><td class="line-number" value="234"></td><td class="line-content">            type: 'Feature',</td></tr><tr><td class="line-number" value="235"></td><td class="line-content">            geometry: {</td></tr><tr><td class="line-number" value="236"></td><td class="line-content">                type: 'Point',</td></tr><tr><td class="line-number" value="237"></td><td class="line-content">                coordinates: [parseFloat(poi.lng), parseFloat(poi.lat)]</td></tr><tr><td class="line-number" value="238"></td><td class="line-content">            },</td></tr><tr><td class="line-number" value="239"></td><td class="line-content">            properties: {</td></tr><tr><td class="line-number" value="240"></td><td class="line-content">                name: poi.name</td></tr><tr><td class="line-number" value="241"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="242"></td><td class="line-content">        }))</td></tr><tr><td class="line-number" value="243"></td><td class="line-content">    };</td></tr><tr><td class="line-number" value="244"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="245"></td><td class="line-content">    // Create initial bus GeoJSON with empty features</td></tr><tr><td class="line-number" value="246"></td><td class="line-content">    const busGeoJSON = {</td></tr><tr><td class="line-number" value="247"></td><td class="line-content">        type: 'FeatureCollection',</td></tr><tr><td class="line-number" value="248"></td><td class="line-content">        features: []</td></tr><tr><td class="line-number" value="249"></td><td class="line-content">    };</td></tr><tr><td class="line-number" value="250"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="251"></td><td class="line-content">    mapboxgl.accessToken = 'pk.eyJ1IjoiYWxpZmRhcnNpbSIsImEiOiJjbTRjZ3djcmIwNTMxMmlxcGZvZWx1eTFqIn0.X3VV1PhXekp3_HAwoB6kbw';</td></tr><tr><td class="line-number" value="252"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="253"></td><td class="line-content">    // Initialize map with default center</td></tr><tr><td class="line-number" value="254"></td><td class="line-content">    const map = new mapboxgl.Map({</td></tr><tr><td class="line-number" value="255"></td><td class="line-content">        container: 'map',</td></tr><tr><td class="line-number" value="256"></td><td class="line-content">        style: 'mapbox://styles/mapbox/streets-v12',</td></tr><tr><td class="line-number" value="257"></td><td class="line-content">        center: [103.317818, 2.029433],</td></tr><tr><td class="line-number" value="258"></td><td class="line-content">        zoom: 8</td></tr><tr><td class="line-number" value="259"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="260"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="261"></td><td class="line-content">    // Wait for map to load before adding layers</td></tr><tr><td class="line-number" value="262"></td><td class="line-content">    map.on('load', () =&gt; {</td></tr><tr><td class="line-number" value="263"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="264"></td><td class="line-content">        // Load both bus stop and bus icons</td></tr><tr><td class="line-number" value="265"></td><td class="line-content">        Promise.all([</td></tr><tr><td class="line-number" value="266"></td><td class="line-content">            new Promise((resolve, reject) =&gt; {</td></tr><tr><td class="line-number" value="267"></td><td class="line-content">                map.loadImage(imageBusStop, (error, image) =&gt; {</td></tr><tr><td class="line-number" value="268"></td><td class="line-content">                    if (error) reject(error);</td></tr><tr><td class="line-number" value="269"></td><td class="line-content">                    map.addImage('bus-stop-icon', image);</td></tr><tr><td class="line-number" value="270"></td><td class="line-content">                    resolve();</td></tr><tr><td class="line-number" value="271"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="272"></td><td class="line-content">            }),</td></tr><tr><td class="line-number" value="273"></td><td class="line-content">            new Promise((resolve, reject) =&gt; {</td></tr><tr><td class="line-number" value="274"></td><td class="line-content">                map.loadImage(imageBus, (error, image) =&gt; {</td></tr><tr><td class="line-number" value="275"></td><td class="line-content">                    if (error) reject(error);</td></tr><tr><td class="line-number" value="276"></td><td class="line-content">                    map.addImage('bus-icon', image);</td></tr><tr><td class="line-number" value="277"></td><td class="line-content">                    resolve();</td></tr><tr><td class="line-number" value="278"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="279"></td><td class="line-content">            }),</td></tr><tr><td class="line-number" value="280"></td><td class="line-content">            new Promise((resolve, reject) =&gt; {</td></tr><tr><td class="line-number" value="281"></td><td class="line-content">                map.loadImage(imageArrows, (error, image) =&gt; {</td></tr><tr><td class="line-number" value="282"></td><td class="line-content">                    if (error) reject(error);</td></tr><tr><td class="line-number" value="283"></td><td class="line-content">                    map.addImage('arrow-icon', image);</td></tr><tr><td class="line-number" value="284"></td><td class="line-content">                    resolve();</td></tr><tr><td class="line-number" value="285"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="286"></td><td class="line-content">            })</td></tr><tr><td class="line-number" value="287"></td><td class="line-content">        ]).then(() =&gt; {</td></tr><tr><td class="line-number" value="288"></td><td class="line-content">            // Add the route source</td></tr><tr><td class="line-number" value="289"></td><td class="line-content">            map.addSource('route', {</td></tr><tr><td class="line-number" value="290"></td><td class="line-content">                'type': 'geojson',</td></tr><tr><td class="line-number" value="291"></td><td class="line-content">                'data': geojson</td></tr><tr><td class="line-number" value="292"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="293"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="294"></td><td class="line-content">            // Add the bus stops source</td></tr><tr><td class="line-number" value="295"></td><td class="line-content">            map.addSource('bus-stops', {</td></tr><tr><td class="line-number" value="296"></td><td class="line-content">                'type': 'geojson',</td></tr><tr><td class="line-number" value="297"></td><td class="line-content">                'data': poisGeoJSON</td></tr><tr><td class="line-number" value="298"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="299"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="300"></td><td class="line-content">            // Add the bus source</td></tr><tr><td class="line-number" value="301"></td><td class="line-content">            map.addSource('bus', {</td></tr><tr><td class="line-number" value="302"></td><td class="line-content">                'type': 'geojson',</td></tr><tr><td class="line-number" value="303"></td><td class="line-content">                'data': busGeoJSON</td></tr><tr><td class="line-number" value="304"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="305"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="306"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="307"></td><td class="line-content">            // Add the arrow layer</td></tr><tr><td class="line-number" value="308"></td><td class="line-content">            map.addLayer({</td></tr><tr><td class="line-number" value="309"></td><td class="line-content">                'id': 'route-arrows',</td></tr><tr><td class="line-number" value="310"></td><td class="line-content">                'type': 'symbol',</td></tr><tr><td class="line-number" value="311"></td><td class="line-content">                'source': 'route',</td></tr><tr><td class="line-number" value="312"></td><td class="line-content">                'layout': {</td></tr><tr><td class="line-number" value="313"></td><td class="line-content">                    'symbol-placement': 'line',</td></tr><tr><td class="line-number" value="314"></td><td class="line-content">                    'symbol-spacing': 25,</td></tr><tr><td class="line-number" value="315"></td><td class="line-content">                    'icon-image': 'arrow-icon',</td></tr><tr><td class="line-number" value="316"></td><td class="line-content">                    'icon-size': 0.3,</td></tr><tr><td class="line-number" value="317"></td><td class="line-content">                    'icon-allow-overlap': true,</td></tr><tr><td class="line-number" value="318"></td><td class="line-content">                    'icon-ignore-placement': true,</td></tr><tr><td class="line-number" value="319"></td><td class="line-content">                    'icon-rotation-alignment': 'map',</td></tr><tr><td class="line-number" value="320"></td><td class="line-content">                    'icon-pitch-alignment': 'map'</td></tr><tr><td class="line-number" value="321"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="322"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="323"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="324"></td><td class="line-content">            // Add the route layer</td></tr><tr><td class="line-number" value="325"></td><td class="line-content">            map.addLayer({</td></tr><tr><td class="line-number" value="326"></td><td class="line-content">                'id': 'route',</td></tr><tr><td class="line-number" value="327"></td><td class="line-content">                'type': 'line',</td></tr><tr><td class="line-number" value="328"></td><td class="line-content">                'source': 'route',</td></tr><tr><td class="line-number" value="329"></td><td class="line-content">                'layout': {</td></tr><tr><td class="line-number" value="330"></td><td class="line-content">                    'line-join': 'round',</td></tr><tr><td class="line-number" value="331"></td><td class="line-content">                    'line-cap': 'round'</td></tr><tr><td class="line-number" value="332"></td><td class="line-content">                },</td></tr><tr><td class="line-number" value="333"></td><td class="line-content">                'paint': {</td></tr><tr><td class="line-number" value="334"></td><td class="line-content">                    'line-color': '#ff0000',</td></tr><tr><td class="line-number" value="335"></td><td class="line-content">                    'line-width': 3</td></tr><tr><td class="line-number" value="336"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="337"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="338"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="339"></td><td class="line-content">            // Add the bus stops layer</td></tr><tr><td class="line-number" value="340"></td><td class="line-content">            map.addLayer({</td></tr><tr><td class="line-number" value="341"></td><td class="line-content">                'id': 'bus-stops',</td></tr><tr><td class="line-number" value="342"></td><td class="line-content">                'type': 'symbol',</td></tr><tr><td class="line-number" value="343"></td><td class="line-content">                'source': 'bus-stops',</td></tr><tr><td class="line-number" value="344"></td><td class="line-content">                'layout': {</td></tr><tr><td class="line-number" value="345"></td><td class="line-content">                    'icon-anchor': 'bottom',</td></tr><tr><td class="line-number" value="346"></td><td class="line-content">                    'icon-image': 'bus-stop-icon',</td></tr><tr><td class="line-number" value="347"></td><td class="line-content">                    'icon-size': [</td></tr><tr><td class="line-number" value="348"></td><td class="line-content">                        'interpolate',</td></tr><tr><td class="line-number" value="349"></td><td class="line-content">                        ['linear'],</td></tr><tr><td class="line-number" value="350"></td><td class="line-content">                        ['zoom'],</td></tr><tr><td class="line-number" value="351"></td><td class="line-content">                        10, 0.45,</td></tr><tr><td class="line-number" value="352"></td><td class="line-content">                        13, 0.55,</td></tr><tr><td class="line-number" value="353"></td><td class="line-content">                        16, 0.65</td></tr><tr><td class="line-number" value="354"></td><td class="line-content">                    ],</td></tr><tr><td class="line-number" value="355"></td><td class="line-content">                    'icon-allow-overlap': true,</td></tr><tr><td class="line-number" value="356"></td><td class="line-content">                    'text-field': ['get', 'name'],</td></tr><tr><td class="line-number" value="357"></td><td class="line-content">                    'text-size': 11.5,</td></tr><tr><td class="line-number" value="358"></td><td class="line-content">                    'text-offset': [0, -1.8],</td></tr><tr><td class="line-number" value="359"></td><td class="line-content">                    'text-anchor': 'bottom',</td></tr><tr><td class="line-number" value="360"></td><td class="line-content">                    'text-optional': true,</td></tr><tr><td class="line-number" value="361"></td><td class="line-content">                    'text-font': ['Arial Unicode MS Bold'],</td></tr><tr><td class="line-number" value="362"></td><td class="line-content">                },</td></tr><tr><td class="line-number" value="363"></td><td class="line-content">                'paint': {</td></tr><tr><td class="line-number" value="364"></td><td class="line-content">                    'text-halo-color': '#ffffff',</td></tr><tr><td class="line-number" value="365"></td><td class="line-content">                    'text-halo-width': 1,</td></tr><tr><td class="line-number" value="366"></td><td class="line-content">                    'text-color': '#6884D9',</td></tr><tr><td class="line-number" value="367"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="368"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="369"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="370"></td><td class="line-content">            // Add the bus layer</td></tr><tr><td class="line-number" value="371"></td><td class="line-content">            map.addLayer({</td></tr><tr><td class="line-number" value="372"></td><td class="line-content">                'id': 'bus',</td></tr><tr><td class="line-number" value="373"></td><td class="line-content">                'type': 'symbol',</td></tr><tr><td class="line-number" value="374"></td><td class="line-content">                'source': 'bus',</td></tr><tr><td class="line-number" value="375"></td><td class="line-content">                'layout': {</td></tr><tr><td class="line-number" value="376"></td><td class="line-content">                    'icon-anchor': 'bottom',</td></tr><tr><td class="line-number" value="377"></td><td class="line-content">                    'icon-image': 'bus-icon',</td></tr><tr><td class="line-number" value="378"></td><td class="line-content">                    'icon-size': [</td></tr><tr><td class="line-number" value="379"></td><td class="line-content">                        'interpolate',</td></tr><tr><td class="line-number" value="380"></td><td class="line-content">                        ['linear'],</td></tr><tr><td class="line-number" value="381"></td><td class="line-content">                        ['zoom'],</td></tr><tr><td class="line-number" value="382"></td><td class="line-content">                        10, 0.65,</td></tr><tr><td class="line-number" value="383"></td><td class="line-content">                        13, 0.75,</td></tr><tr><td class="line-number" value="384"></td><td class="line-content">                        16, 0.85</td></tr><tr><td class="line-number" value="385"></td><td class="line-content">                    ],</td></tr><tr><td class="line-number" value="386"></td><td class="line-content">                    'icon-allow-overlap': true,</td></tr><tr><td class="line-number" value="387"></td><td class="line-content">                    'text-field': ['get', 'busId'],</td></tr><tr><td class="line-number" value="388"></td><td class="line-content">                    'text-size': 12,</td></tr><tr><td class="line-number" value="389"></td><td class="line-content">                    'text-offset': [0, -2.1],</td></tr><tr><td class="line-number" value="390"></td><td class="line-content">                    'text-anchor': 'bottom',</td></tr><tr><td class="line-number" value="391"></td><td class="line-content">                    'text-optional': true,</td></tr><tr><td class="line-number" value="392"></td><td class="line-content">                    'text-font': ['Arial Unicode MS Bold']</td></tr><tr><td class="line-number" value="393"></td><td class="line-content">                },</td></tr><tr><td class="line-number" value="394"></td><td class="line-content">                'paint': {</td></tr><tr><td class="line-number" value="395"></td><td class="line-content">                    'text-halo-color': '#ffffff',</td></tr><tr><td class="line-number" value="396"></td><td class="line-content">                    'text-halo-width': 1,</td></tr><tr><td class="line-number" value="397"></td><td class="line-content">                    'text-color': '#ff3c00'</td></tr><tr><td class="line-number" value="398"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="399"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="400"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="401"></td><td class="line-content">            // Add popup on click for buses</td></tr><tr><td class="line-number" value="402"></td><td class="line-content">            map.on('click', 'bus', (e) =&gt; {</td></tr><tr><td class="line-number" value="403"></td><td class="line-content">                const coordinates = e.features[0].geometry.coordinates.slice();</td></tr><tr><td class="line-number" value="404"></td><td class="line-content">                const busId = e.features[0].properties.busId;</td></tr><tr><td class="line-number" value="405"></td><td class="line-content">                const lastUpdate = new Date(e.features[0].properties.lastUpdate).toLocaleString();</td></tr><tr><td class="line-number" value="406"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="407"></td><td class="line-content">                new mapboxgl.Popup({</td></tr><tr><td class="line-number" value="408"></td><td class="line-content">                    anchor: 'bottom',</td></tr><tr><td class="line-number" value="409"></td><td class="line-content">                    offset: [0, -40]</td></tr><tr><td class="line-number" value="410"></td><td class="line-content">                })</td></tr><tr><td class="line-number" value="411"></td><td class="line-content">                    .setLngLat(coordinates)</td></tr><tr><td class="line-number" value="412"></td><td class="line-content">                    .setHTML(`</td></tr><tr><td class="line-number" value="413"></td><td class="line-content">                        &lt;p class="bus-stop-name"&gt;Bus ${busId}&lt;/p&gt;</td></tr><tr><td class="line-number" value="414"></td><td class="line-content">                        &lt;p style="margin: 5px 0 0 0; font-size: 12px;"&gt;Update: ${lastUpdate}&lt;/p&gt;</td></tr><tr><td class="line-number" value="415"></td><td class="line-content">                    `)</td></tr><tr><td class="line-number" value="416"></td><td class="line-content">                    .addTo(map);</td></tr><tr><td class="line-number" value="417"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="418"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="419"></td><td class="line-content">            // Change cursor on hover for buses</td></tr><tr><td class="line-number" value="420"></td><td class="line-content">            map.on('mouseenter', 'bus', () =&gt; {</td></tr><tr><td class="line-number" value="421"></td><td class="line-content">                map.getCanvas().style.cursor = 'pointer';</td></tr><tr><td class="line-number" value="422"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="423"></td><td class="line-content">            map.on('mouseleave', 'bus', () =&gt; {</td></tr><tr><td class="line-number" value="424"></td><td class="line-content">                map.getCanvas().style.cursor = '';</td></tr><tr><td class="line-number" value="425"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="426"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="427"></td><td class="line-content">            // Add popup on click for bus stops</td></tr><tr><td class="line-number" value="428"></td><td class="line-content">            map.on('click', 'bus-stops', (e) =&gt; {</td></tr><tr><td class="line-number" value="429"></td><td class="line-content">                const coordinates = e.features[0].geometry.coordinates.slice();</td></tr><tr><td class="line-number" value="430"></td><td class="line-content">                const name = e.features[0].properties.name;</td></tr><tr><td class="line-number" value="431"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="432"></td><td class="line-content">                new mapboxgl.Popup()</td></tr><tr><td class="line-number" value="433"></td><td class="line-content">                    .setLngLat(coordinates)</td></tr><tr><td class="line-number" value="434"></td><td class="line-content">                    .setHTML(`&lt;p class="bus-stop-name"&gt;${name}&lt;/p&gt;`)</td></tr><tr><td class="line-number" value="435"></td><td class="line-content">                    .addTo(map);</td></tr><tr><td class="line-number" value="436"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="437"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="438"></td><td class="line-content">            // Change cursor on hover for bus stops</td></tr><tr><td class="line-number" value="439"></td><td class="line-content">            map.on('mouseenter', 'bus-stops', () =&gt; {</td></tr><tr><td class="line-number" value="440"></td><td class="line-content">                map.getCanvas().style.cursor = 'pointer';</td></tr><tr><td class="line-number" value="441"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="442"></td><td class="line-content">            map.on('mouseleave', 'bus-stops', () =&gt; {</td></tr><tr><td class="line-number" value="443"></td><td class="line-content">                map.getCanvas().style.cursor = '';</td></tr><tr><td class="line-number" value="444"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="445"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="446"></td><td class="line-content">            // Get the bounds of all features</td></tr><tr><td class="line-number" value="447"></td><td class="line-content">            const coordinates = geojson.features[0].geometry.coordinates;</td></tr><tr><td class="line-number" value="448"></td><td class="line-content">            const bounds = coordinates.reduce((bounds, coord) =&gt; {</td></tr><tr><td class="line-number" value="449"></td><td class="line-content">                return bounds.extend(coord);</td></tr><tr><td class="line-number" value="450"></td><td class="line-content">            }, new mapboxgl.LngLatBounds(coordinates[0], coordinates[0]));</td></tr><tr><td class="line-number" value="451"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="452"></td><td class="line-content">            // Extend bounds to include POIs</td></tr><tr><td class="line-number" value="453"></td><td class="line-content">            pois.forEach(poi =&gt; {</td></tr><tr><td class="line-number" value="454"></td><td class="line-content">                bounds.extend([parseFloat(poi.lng), parseFloat(poi.lat)]);</td></tr><tr><td class="line-number" value="455"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="456"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="457"></td><td class="line-content">            // Fit the map to the route with padding</td></tr><tr><td class="line-number" value="458"></td><td class="line-content">            map.fitBounds(bounds, {</td></tr><tr><td class="line-number" value="459"></td><td class="line-content">                padding: 50,</td></tr><tr><td class="line-number" value="460"></td><td class="line-content">                duration: 1000</td></tr><tr><td class="line-number" value="461"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="462"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="463"></td><td class="line-content">        }).catch(error =&gt; console.error('Error loading images:', error));</td></tr><tr><td class="line-number" value="464"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="465"></td><td class="line-content">        updateBusLocation();</td></tr><tr><td class="line-number" value="466"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="467"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="468"></td><td class="line-content">    // Function to fetch and update bus location</td></tr><tr><td class="line-number" value="469"></td><td class="line-content">    function updateBusLocation() {</td></tr><tr><td class="line-number" value="470"></td><td class="line-content">        $.ajax({</td></tr><tr><td class="line-number" value="471"></td><td class="line-content">            url: `https://live.paj.com.my/get/PE001`,</td></tr><tr><td class="line-number" value="472"></td><td class="line-content">            method: 'get',</td></tr><tr><td class="line-number" value="473"></td><td class="line-content">            cache: false,</td></tr><tr><td class="line-number" value="474"></td><td class="line-content">            dataType: "json",</td></tr><tr><td class="line-number" value="475"></td><td class="line-content">            success: function(result) {</td></tr><tr><td class="line-number" value="476"></td><td class="line-content">                if (result.success) {</td></tr><tr><td class="line-number" value="477"></td><td class="line-content">                    let arrayData = Object.values(result.data);</td></tr><tr><td class="line-number" value="478"></td><td class="line-content">                    // Update bus positions in GeoJSON</td></tr><tr><td class="line-number" value="479"></td><td class="line-content">                    const newBusGeoJSON = {</td></tr><tr><td class="line-number" value="480"></td><td class="line-content">                        type: 'FeatureCollection',</td></tr><tr><td class="line-number" value="481"></td><td class="line-content">                        features: arrayData.map(bus =&gt; ({</td></tr><tr><td class="line-number" value="482"></td><td class="line-content">                            type: 'Feature',</td></tr><tr><td class="line-number" value="483"></td><td class="line-content">                            geometry: {</td></tr><tr><td class="line-number" value="484"></td><td class="line-content">                                type: 'Point',</td></tr><tr><td class="line-number" value="485"></td><td class="line-content">                                coordinates: [bus.lng, bus.lat]</td></tr><tr><td class="line-number" value="486"></td><td class="line-content">                            },</td></tr><tr><td class="line-number" value="487"></td><td class="line-content">                            properties: {</td></tr><tr><td class="line-number" value="488"></td><td class="line-content">                                busId: bus.bus,</td></tr><tr><td class="line-number" value="489"></td><td class="line-content">                                title: `Bus ${bus.bus}`,</td></tr><tr><td class="line-number" value="490"></td><td class="line-content">                                lastUpdate: bus.time</td></tr><tr><td class="line-number" value="491"></td><td class="line-content">                            }</td></tr><tr><td class="line-number" value="492"></td><td class="line-content">                        }))</td></tr><tr><td class="line-number" value="493"></td><td class="line-content">                    };</td></tr><tr><td class="line-number" value="494"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="495"></td><td class="line-content">                    try {</td></tr><tr><td class="line-number" value="496"></td><td class="line-content">                        map.getSource('bus').setData(newBusGeoJSON);</td></tr><tr><td class="line-number" value="497"></td><td class="line-content">                        // Update the sliding cards</td></tr><tr><td class="line-number" value="498"></td><td class="line-content">                        updateBusCards(arrayData);</td></tr><tr><td class="line-number" value="499"></td><td class="line-content">                    } catch (e) {</td></tr><tr><td class="line-number" value="500"></td><td class="line-content">                        // console.error('Error updating map:', e);</td></tr><tr><td class="line-number" value="501"></td><td class="line-content">                    }</td></tr><tr><td class="line-number" value="502"></td><td class="line-content">                } else {</td></tr><tr><td class="line-number" value="503"></td><td class="line-content">                    // console.log('Error:', result.message);</td></tr><tr><td class="line-number" value="504"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="505"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="506"></td><td class="line-content">        });</td></tr><tr><td class="line-number" value="507"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="508"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="509"></td><td class="line-content">    // Function to update bus cards</td></tr><tr><td class="line-number" value="510"></td><td class="line-content">    function updateBusCards(busData) {</td></tr><tr><td class="line-number" value="511"></td><td class="line-content">        const busCardsContainer = document.getElementById('busCards');</td></tr><tr><td class="line-number" value="512"></td><td class="line-content">        busCardsContainer.innerHTML = ''; // Clear existing cards</td></tr><tr><td class="line-number" value="513"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="514"></td><td class="line-content">        if (busData.length &lt; 3) {</td></tr><tr><td class="line-number" value="515"></td><td class="line-content">            // Center the container for a single bus</td></tr><tr><td class="line-number" value="516"></td><td class="line-content">            busCardsContainer.style.display = 'flex';</td></tr><tr><td class="line-number" value="517"></td><td class="line-content">            busCardsContainer.style.justifyContent = 'center';</td></tr><tr><td class="line-number" value="518"></td><td class="line-content">        } else {</td></tr><tr><td class="line-number" value="519"></td><td class="line-content">            // Restore default styles for multiple buses</td></tr><tr><td class="line-number" value="520"></td><td class="line-content">            busCardsContainer.style.display = 'block';</td></tr><tr><td class="line-number" value="521"></td><td class="line-content">            busCardsContainer.style.justifyContent = ''; // Clear the justifyContent</td></tr><tr><td class="line-number" value="522"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="523"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="524"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="525"></td><td class="line-content">        busData.forEach(bus =&gt; {</td></tr><tr><td class="line-number" value="526"></td><td class="line-content">            const card = document.createElement('div');</td></tr><tr><td class="line-number" value="527"></td><td class="line-content">            card.className = 'bus-card';</td></tr><tr><td class="line-number" value="528"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="529"></td><td class="line-content">            // Check if the last update is within the last 30 minutes</td></tr><tr><td class="line-number" value="530"></td><td class="line-content">            const lastUpdateTime = new Date(bus.time);</td></tr><tr><td class="line-number" value="531"></td><td class="line-content">            // const timeDifferenceInMinutes = (currentTime - lastUpdateTime) / (1000 * 60);</td></tr><tr><td class="line-number" value="532"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="533"></td><td class="line-content">            // if (timeDifferenceInMinutes &lt;= 30) {</td></tr><tr><td class="line-number" value="534"></td><td class="line-content">            //     card.style.background = 'rgb(20,192,80)'; // Light green background</td></tr><tr><td class="line-number" value="535"></td><td class="line-content">            // }</td></tr><tr><td class="line-number" value="536"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="537"></td><td class="line-content">            card.onclick = () =&gt; {</td></tr><tr><td class="line-number" value="538"></td><td class="line-content">                // Remove active class from all cards</td></tr><tr><td class="line-number" value="539"></td><td class="line-content">                document.querySelectorAll('.bus-card').forEach(c =&gt; c.classList.remove('active'));</td></tr><tr><td class="line-number" value="540"></td><td class="line-content">                // Add active class to clicked card</td></tr><tr><td class="line-number" value="541"></td><td class="line-content">                card.classList.add('active');</td></tr><tr><td class="line-number" value="542"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="543"></td><td class="line-content">                // Fly to bus location</td></tr><tr><td class="line-number" value="544"></td><td class="line-content">                map.flyTo({</td></tr><tr><td class="line-number" value="545"></td><td class="line-content">                    center: [bus.lng, bus.lat],</td></tr><tr><td class="line-number" value="546"></td><td class="line-content">                    zoom: 15,</td></tr><tr><td class="line-number" value="547"></td><td class="line-content">                    duration: 1000</td></tr><tr><td class="line-number" value="548"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="549"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="550"></td><td class="line-content">                // Show popup for the bus</td></tr><tr><td class="line-number" value="551"></td><td class="line-content">                new mapboxgl.Popup({</td></tr><tr><td class="line-number" value="552"></td><td class="line-content">                    anchor: 'bottom',</td></tr><tr><td class="line-number" value="553"></td><td class="line-content">                    offset: [0, -40]</td></tr><tr><td class="line-number" value="554"></td><td class="line-content">                })</td></tr><tr><td class="line-number" value="555"></td><td class="line-content">                    .setLngLat([bus.lng, bus.lat])</td></tr><tr><td class="line-number" value="556"></td><td class="line-content">                    .setHTML(`</td></tr><tr><td class="line-number" value="557"></td><td class="line-content">                    &lt;p class="bus-stop-name"&gt;Bus ${bus.bus}&lt;/p&gt;</td></tr><tr><td class="line-number" value="558"></td><td class="line-content">                    &lt;p style="margin: 0 0 0 0; font-size: 12px;"&gt;Update: ${lastUpdateTime.toLocaleString()}&lt;/p&gt;</td></tr><tr><td class="line-number" value="559"></td><td class="line-content">                `)</td></tr><tr><td class="line-number" value="560"></td><td class="line-content">                    .addTo(map);</td></tr><tr><td class="line-number" value="561"></td><td class="line-content">            };</td></tr><tr><td class="line-number" value="562"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="563"></td><td class="line-content">            let time = new Date(bus.time);</td></tr><tr><td class="line-number" value="564"></td><td class="line-content">            let now = new Date();</td></tr><tr><td class="line-number" value="565"></td><td class="line-content">            let timeDifference = (now - time) / (1000 * 60); // Difference in minutes</td></tr><tr><td class="line-number" value="566"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="567"></td><td class="line-content">            let onlineStat = '';</td></tr><tr><td class="line-number" value="568"></td><td class="line-content">            // Apply green background if less than 30 minutes</td></tr><tr><td class="line-number" value="569"></td><td class="line-content">            if (timeDifference &lt; 30) {</td></tr><tr><td class="line-number" value="570"></td><td class="line-content">                // add a class to the card</td></tr><tr><td class="line-number" value="571"></td><td class="line-content">                onlineStat = `&lt;i class="fa-solid fa-signal-stream mt-1 fs-2 online" style="color: #0fa354 !important;"&gt;&lt;/i&gt;`;</td></tr><tr><td class="line-number" value="572"></td><td class="line-content">                card.classList.add('online');</td></tr><tr><td class="line-number" value="573"></td><td class="line-content">                card.classList.remove('offline');</td></tr><tr><td class="line-number" value="574"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="575"></td><td class="line-content">            else {</td></tr><tr><td class="line-number" value="576"></td><td class="line-content">                // remove the class</td></tr><tr><td class="line-number" value="577"></td><td class="line-content">                onlineStat = `&lt;i class="fa-solid fa-signal-stream-slash mt-1 fs-2 offline" style="color: #ff274f !important;"&gt;&lt;/i&gt;`;</td></tr><tr><td class="line-number" value="578"></td><td class="line-content">                card.classList.remove('online');</td></tr><tr><td class="line-number" value="579"></td><td class="line-content">                card.classList.add('offline');</td></tr><tr><td class="line-number" value="580"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="581"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="582"></td><td class="line-content">            // Format time as dd/mm/yyyy hh:mm:ss AM/PM</td></tr><tr><td class="line-number" value="583"></td><td class="line-content">            let timeString = time.toLocaleString('en-GB', {hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true});</td></tr><tr><td class="line-number" value="584"></td><td class="line-content">            card.innerHTML = `</td></tr><tr><td class="line-number" value="585"></td><td class="line-content">                &lt;div class="d-flex justify-content-between"&gt;</td></tr><tr><td class="line-number" value="586"></td><td class="line-content">                    &lt;div class="d-flex"&gt;</td></tr><tr><td class="line-number" value="587"></td><td class="line-content">                        &lt;div class="legend-icon me-1" style="background-image: url(https://live.paj.com.my/assets/bus-marker.png)"&gt;&lt;/div&gt;</td></tr><tr><td class="line-number" value="588"></td><td class="line-content">                        &lt;p class="bus-id mb-0 fs-4 fw-bold"&gt;${bus.bus}&lt;/p&gt;</td></tr><tr><td class="line-number" value="589"></td><td class="line-content">                    &lt;/div&gt;</td></tr><tr><td class="line-number" value="590"></td><td class="line-content">                    ${onlineStat}</td></tr><tr><td class="line-number" value="591"></td><td class="line-content">                &lt;/div&gt;</td></tr><tr><td class="line-number" value="592"></td><td class="line-content">                &lt;p class="last-update fs-7 fw-bold"&gt;&lt;i class="fa-solid fa-clock ms-1 me-2 text-primary"&gt;&lt;/i&gt;${timeString.toUpperCase()}&lt;/p&gt;</td></tr><tr><td class="line-number" value="593"></td><td class="line-content">            `;</td></tr><tr><td class="line-number" value="594"></td><td class="line-content">            busCardsContainer.appendChild(card);</td></tr><tr><td class="line-number" value="595"></td><td class="line-content">        });</td></tr><tr><td class="line-number" value="596"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="597"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="598"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="599"></td><td class="line-content">    // interval to update bus location</td></tr><tr><td class="line-number" value="600"></td><td class="line-content">    setInterval(updateBusLocation, 10000);</td></tr><tr><td class="line-number" value="601"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="602"></td><td class="line-content"><span class="html-tag">&lt;/body&gt;</span></td></tr><tr><td class="line-number" value="603"></td><td class="line-content"><span class="html-tag">&lt;/html&gt;</span></td></tr><tr><td class="line-number" value="604"></td><td class="line-content"><span class="html-end-of-file"></span></td></tr></tbody></table></body></html>